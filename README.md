# 辽宁省网刊价格数据提取工具使用说明

## 1. 程序概述

**辽宁省网刊价格数据提取工具**是一款用于从辽宁省建设工程材料价格网站提取数据的桌面应用程序，采用现代化UI设计，支持多城市、多年份数据查询和提取，并提供多种数据导出格式。

### 1.1 开发语言与技术栈
- **开发语言**：Python 3.10+
- **GUI框架**：tkinter + ttkbootstrap
- **网络请求**：requests
- **网页解析**：BeautifulSoup4
- **数据处理**：pandas
- **打包工具**：PyInstaller

## 2. 功能特点

### 2.1 核心功能
- ✅ **网站连接**：自动连接辽宁省建设工程材料价格网站
- ✅ **城市选择**：支持辽宁省内多个城市数据查询
- ✅ **日期选择**：支持多年份、多月份数据查询
- ✅ **数据查询**：获取符合条件的数据总条数和页数
- ✅ **数据提取**：支持单页或全部页面数据提取
- ✅ **数据导出**：支持Excel、CSV等多种格式导出
- ✅ **进度显示**：实时显示数据提取进度
- ✅ **日志记录**：详细记录程序执行过程

### 2.2 高级功能
- ✅ **现代化UI**：采用ttkbootstrap实现的扁平化设计
- ✅ **无边框窗口**：自定义标题栏和窗口控制
- ✅ **窗口拖动**：支持标题栏拖动窗口
- ✅ **临时文件管理**：自动创建和清理TEMP目录
- ✅ **打包支持**：支持PyInstaller打包为单个EXE文件
- ✅ **图标定制**：支持自定义应用图标

## 3. 安装说明

### 3.1 环境要求
- **操作系统**：Windows 7/8/10/11
- **Python版本**：Python 3.10 或更高版本
- **依赖库**：
  - requests
  - beautifulsoup4
  - pandas
  - ttkbootstrap
  - openpyxl
  - xlwt

### 3.2 安装步骤

#### 方法1：直接运行可执行文件
1. 从提供的压缩包中解压文件
2. 找到`辽宁省网刊.exe`文件
3. 双击运行即可

#### 方法2：从源码运行
1. 安装Python 3.10+
2. 安装依赖库：
   ```bash
   pip install requests beautifulsoup4 pandas ttkbootstrap openpyxl xlwt
   ```
3. 运行程序：
   ```bash
   python main.py
   ```

#### 方法3：自行打包
1. 安装PyInstaller：
   ```bash
   pip install pyinstaller
   ```
2. 执行打包命令：
   ```bash
   pyinstaller -w -F -i dk.ico --name="辽宁省网刊" main.py
   ```
3. 在`dist`目录中找到生成的可执行文件

## 4. 使用方法

### 4.1 启动程序
双击`辽宁省网刊.exe`或运行`python main.py`启动程序。

### 4.2 操作流程

#### 步骤1：连接网站
1. 点击「连接网站」按钮
2. 等待连接成功提示
3. 连接状态显示为「已连接」

#### 步骤2：选择参数
1. **城市选择**：从下拉菜单中选择目标城市
2. **年份选择**：选择查询年份
3. **月份选择**：选择查询月份

#### 步骤3：查询数据
1. 点击「查询数据」按钮
2. 等待查询结果
3. 查看显示的总页数和总记录数

#### 步骤4：提取数据
1. 选择「提取所有页」或仅提取当前页
2. 点击「提取数据」按钮
3. 等待数据提取完成
4. 查看提取结果

#### 步骤5：导出数据
1. 点击「导出数据」按钮
2. 选择保存路径和文件格式
3. 等待导出完成

## 5. 程序结构

### 5.1 目录结构
```
辽宁省网刊价格数据提取工具
├── main.py              # 主程序文件
├── dk.ico              # 应用程序图标
├── 辽宁省网刊.spec      # PyInstaller打包配置
├── 辽宁省网刊1.0.spec    # 历史打包配置
├── 辽宁省网刊1.1.spec    # 历史打包配置
├── setup.py            # cx_Freeze打包配置
└── 程序说明.md          # 程序说明文档
```

### 5.2 核心类与方法

| 类/方法 | 功能描述 |
|---------|---------|
| `MaterialPriceScraper` | 主程序类 |
| `__init__()` | 初始化程序，创建TEMP目录 |
| `connect_to_website()` | 连接到目标网站 |
| `get_city_list()` | 获取城市列表 |
| `query_data()` | 查询数据，获取总条数和页数 |
| `extract_data()` | 提取数据 |
| `export_data()` | 导出数据到Excel/CSV |
| `close_window()` | 关闭窗口，清理TEMP目录 |

## 6. 核心功能实现

### 6.1 网站连接机制
- 使用`requests.Session`保持会话
- 自定义User-Agent和Referer头部
- 实现3次重试机制
- 60秒超时设置

### 6.2 数据提取流程
1. 发送GET请求获取网页内容
2. 使用BeautifulSoup解析HTML
3. 查找并提取数据表格
4. 评分系统选择最佳数据表格
5. 提取表头和数据行
6. 数据清洗和格式化

### 6.3 数据导出实现
- **Excel导出**：使用openpyxl引擎，支持.xlsx格式
- **CSV导出**：使用utf-8-sig编码，支持BOM头
- **文件名生成**：自动生成包含城市、年份、月份的文件名

### 6.4 TEMP目录管理
- 程序启动时创建TEMP目录
- 调试文件保存到TEMP目录
- 程序退出时自动删除TEMP目录
- 支持单个EXE文件运行时TEMP目录与程序同目录

## 7. 使用示例

### 7.1 基本使用流程

1. **启动程序**：双击`辽宁省网刊.exe`
2. **连接网站**：点击「连接网站」按钮
3. **选择参数**：
   - 城市：鞍山市
   - 年份：2025
   - 月份：01
4. **查询数据**：点击「查询数据」
5. **提取数据**：点击「提取数据」（默认提取所有页）
6. **导出数据**：点击「导出数据」，选择保存路径和格式

### 7.2 导出文件名示例
```
辽宁省鞍山市2025年01月份网刊.xlsx
辽宁省沈阳市2024年12月份网刊.csv
```

## 8. 常见问题与解决方案

### 8.1 连接失败
- **问题**：显示「未连接」或连接超时
- **解决方案**：
  - 检查网络连接
  - 确保网站可以正常访问
  - 尝试再次点击「连接网站」按钮

### 8.2 数据提取失败
- **问题**：提取数据时出错
- **解决方案**：
  - 确保已成功连接网站
  - 检查选择的城市和日期是否正确
  - 尝试重新提取

### 8.3 导出文件乱码
- **问题**：导出的Excel或CSV文件打开后乱码
- **解决方案**：
  - 确保使用正确的打开方式
  - CSV文件使用Excel打开时选择utf-8编码
  - 尝试使用不同的导出格式

### 8.4 程序崩溃
- **问题**：程序意外关闭
- **解决方案**：
  - 检查Python版本是否符合要求
  - 确保所有依赖库已正确安装
  - 尝试重新启动程序

## 9. 更新日志

### 1.2 版本（2026-01-14）
- ✅ 优化TEMP目录管理，支持单个EXE文件
- ✅ 修复窗口最小化报错
- ✅ 完善打包配置
- ✅ 添加详细的程序说明文档

### 1.1 版本（2026-01-13）
- ✅ 采用ttkbootstrap现代化UI
- ✅ 实现无边框窗口设计
- ✅ 优化标题栏样式
- ✅ 改进按钮样式和颜色

### 1.0 版本（2026-01-12）
- ✅ 实现网站连接功能
- ✅ 支持多城市数据查询
- ✅ 实现数据提取和导出
- ✅ 支持Excel和CSV格式
- ✅ 实现进度显示和日志记录

## 10. 注意事项

1. **网络要求**：程序需要连接互联网才能使用
2. **数据来源**：数据来源于辽宁省建设工程材料价格网站
3. **使用频率**：请勿频繁访问网站，避免给网站服务器造成压力
4. **数据版权**：提取的数据仅供参考，版权归原网站所有
5. **程序更新**：定期检查程序更新，获取最新功能
6. **安全提示**：从可靠来源获取程序，避免使用修改版

## 11. 联系方式

如果您在使用过程中遇到问题，或有任何建议和反馈，欢迎联系开发人员。

---

**更新时间**：2026-01-14  
**版本**：1.2  
**开发团队**：辽宁省网刊价格数据提取工具开发组
